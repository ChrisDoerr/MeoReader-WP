MeoReader.Subscriptions={categories:{toggleState:1}};MeoReader.Subscriptions.show_moveFeed_box=function(feedID,feedName,categories){var html="",i=0;html+="<p>"+MeoReader.i18n.get("Move")+" <strong>"+feedName+"</strong> ";html+=MeoReader.i18n.get("to category")+"...</p>\n";html+='<ul class="meoReader_box_select" data-fid="'+feedID+'">\n';for(i=0;i<categories.length;i++){html+=" <li";if(i===0){html+=' class="first" data-cd="'+categories[i].id+'">'+categories[i].name+"</li>\n";}else{html+=' data-cd="'+categories[i].id+'">';html+='<a href="javascript:void(0);" data-cd="'+categories[i].id+'">'+categories[i].name+"</a>";html+="</li>\n";}}html+="</ul>\n";MeoReader.box.create({id:"MeoReader_Subscriptions_MoveFeed",title:MeoReader.i18n.get("Move Feed"),body:html,width:400,top:100,button:{ok:{enable:true,label:MeoReader.i18n.get("btn_Move")},cancel:{enable:true},close:{enable:false}},state:"neutral",data:{feedID:feedID}});};MeoReader.Subscriptions.renameCategory=function(catItem,titleElement){titleElement.html('<input id="meoReader_renameCat-'+catItem.attr("data-cid")+'" type="text" value="'+catItem.attr("data-title")+'" />');titleElement.children("input").focus().keyup(function(e){if(e.which===13){titleElement.addClass("loading");jQuery.post(ajaxurl,{action:"meoReader",method:"renameCategory",catFrom:catItem.attr("data-cid"),catTo:jQuery("#meoReader_renameCat-"+catItem.attr("data-cid")).val(),meoNonce:MeoReader.nonce.get("meoReader_renameCategory")},function(response){var data=jQuery.parseJSON(response);if(data.request===true){MeoReader.updateSubscriptionList();MeoReader.Subscriptions.updateCategorySelectList();MeoReader.box.reset();}else{MeoReader.loading.stop();MeoReader.box.create({id:"tmp",title:MeoReader.i18n.get("Error"),body:"<p>"+data.message+"</p>",width:400,top:100,button:{ok:{enable:false},cancel:{enable:false},close:{enable:true}},state:"error",data:{}});}});}if(e.which===1||e.which===27){titleElement.html(catItem.attr("data-title")+" ("+catItem.attr("data-noi")+")");}});};MeoReader.Subscriptions.show_deleteItem_box=function(element){var data={},config={},href=element.attr("href"),action=href.match(/action=([^&]+)&/),itemID=href.match(/itemID=([0-9]+)/),msg="<p>"+MeoReader.i18n.get("Are you sure you want to delete this %type%")+"?</p>";if(action[1]==="undefined"||itemID[1]==="undefined"){return false;}if(action[1]==="deleteCategory"){config={id:"MeoReader_Confirm_DeleteCategory",type:MeoReader.i18n.get("category")};data.catID=itemID[1];}else{if(action[1]==="deleteFeed"){config={id:"MeoReader_Confirm_DeleteFeed",type:MeoReader.i18n.get("feed")};data.feedID=itemID[1];}else{return false;}}if(config.id===""){return false;}MeoReader.box.create({id:config.id,title:MeoReader.i18n.get("Confirm Deletion"),body:msg.replace("%type%",config.type),width:400,top:100,button:{ok:{enable:true,label:MeoReader.i18n.get("Yes")},cancel:{enable:true},close:{enable:false}},state:"neutral",data:data});};MeoReader.Subscriptions.deleteCategory=function(){MeoReader.box.title.addClass("loading");jQuery.post(ajaxurl,{action:"meoReader",method:"deleteCategory",catID:MeoReader.box.data.catID},function(response){MeoReader.box.title.removeClass("loading");var data=jQuery.parseJSON(response);if(data.request===true){MeoReader.updateSubscriptionList();MeoReader.Subscriptions.updateCategorySelectList();MeoReader.box.reset();}else{MeoReader.loading.stop();MeoReader.box.create({id:"tmp",title:MeoReader.i18n.get("Error"),body:"<p>"+data.message+"</p>",width:400,top:100,button:{ok:{enable:false},cancel:{enable:false},close:{enable:true}},state:"error",data:{}});}});};MeoReader.Subscriptions.deleteFeed=function(){MeoReader.box.title.addClass("loading");jQuery.post(ajaxurl,{action:"meoReader",method:"deleteFeed",feedID:MeoReader.box.data.feedID},function(response){MeoReader.box.title.removeClass("loading");var data=jQuery.parseJSON(response);if(data.request===true){MeoReader.updateSubscriptionList();MeoReader.box.reset();}else{MeoReader.loading.stop();MeoReader.box.create({id:"tmp",title:MeoReader.i18n.get("Error"),body:"<p>"+data.message+"</p>",width:400,top:100,button:{ok:{enable:false},cancel:{enable:false},close:{enable:true}},state:"error",data:{}});}});};MeoReader.Subscriptions.prepare_moveFeed_box=function(element){var feedItem=element.parent().parent().parent();jQuery.post(ajaxurl,{action:"meoReader",method:"getCategoryList"},function(response){var data=jQuery.parseJSON(response);if(data.request===true){MeoReader.Subscriptions.show_moveFeed_box(feedItem.attr("data-fid"),feedItem.attr("data-name"),data.categories);}else{MeoReader.loading.stop();MeoReader.box.create({id:"tmp",title:MeoReader.i18n.get("Error"),body:"<p>"+data.message+"</p>",width:400,top:100,button:{ok:{enable:false},cancel:{enable:false},close:{enable:true}},state:"error",data:{}});}});};MeoReader.Subscriptions.moveFeed=function(){var catList=MeoReader.box.body.children("ul"),feedID=catList.attr("data-fid"),catID=catList.children("li.first").attr("data-cd");jQuery.post(ajaxurl,{action:"meoReader",method:"moveFeed",feedID:feedID,catID:catID,meoNonce:MeoReader.nonce.get("meoReader_moveFeed")},function(response){var data=jQuery.parseJSON(response);if(data.request===true){MeoReader.updateSubscriptionList();MeoReader.box.reset();}else{MeoReader.loading.stop();MeoReader.box.create({id:"tmp",title:MeoReader.i18n.get("Error"),body:"<p>"+data.message+"</p>",width:400,top:100,button:{ok:{enable:false},cancel:{enable:false},close:{enable:true}},state:"error",data:{}});}});};MeoReader.Subscriptions.updateCategorySelectList=function(){jQuery.post(ajaxurl,{action:"meoReader",method:"getCategoryList"},function(response){var data=jQuery.parseJSON(response),i=0,html="";if(data.request===true){for(i=0;i<data.categories.length;i++){html+='<option value="'+data.categories[i].id+'"';if(data.categories[i].id===1){html+=' selected="selected"';}html+=">"+data.categories[i].name+"</option>";}jQuery("#meoReaderForm_AddFeed_category").html(html);}});};MeoReader.Subscriptions.toggleCategoryFeeds=function(element,event){if(event.target.nodeName!=="A"&&event.target.nodeName!=="INPUT"&&event.target.nodeName!=="LABEL"){element.next(".entries").toggle();if(element.hasClass("close")){element.removeClass("close").addClass("open");}else{element.removeClass("open").addClass("close");}}};MeoReader.updateSubscriptionList=function(){jQuery.post(ajaxurl,{action:"meoReader",method:"getSubscriptionList"},function(response){var data=jQuery.parseJSON(response);if(data.request===true){MeoReader.updateSubscriptionListTemplate(MeoReader.generateSubscriptionList(data.data));}});};MeoReader.generateSubscriptionList=function(data){var html="",i=0,n=0;for(i=0;i<data.length;i++){html+='<h4 class="category" data-noi="'+data[i].items+'" data-cid="'+data[i].id+'" data-title="'+data[i].name+'">';html+="<label>"+data[i].name+" ("+data[i].items+")</label><span>";if(data[i].id!==1){html+='<a href="admin.php?page=meoreader_subscriptions&amp;action=deleteCategory&amp;itemID='+data[i].id+'" class="delete" title="'+MeoReader.i18n.get("Delete this category")+'">'+MeoReader.i18n.get("delete")+"</a> | ";}html+='<a href="admin.php?page=meoreader_renameCategory&amp;itemID='+data[i].id+'" title="'+MeoReader.i18n.get("Rename this category")+'" class="renameCategory">'+MeoReader.i18n.get("rename")+"</a></span></h4>\n";html+='<div class="entries">\n';if(data[i].feeds.length>0){for(n=0;n<data[i].feeds.length;n++){html+='<div class="feedItem" data-fid="'+data[i].feeds[n].id+'" data-name="'+data[i].feeds[n].name+'">';html+=' <div class="name">'+data[i].feeds[n].name+'<span><a href="admin.php?page=meoreader_subscriptions&amp;action=deleteFeed&amp;itemID='+data[i].feeds[n].id+'" class="delete" title="'+MeoReader.i18n.get("Delete this feed")+'">'+MeoReader.i18n.get("delete")+'</a> | <a href="admin.php?page=meoreader_feedChecker&amp;feedURL='+encodeURIComponent(data[i].feeds[n].xml_url)+'">'+MeoReader.i18n.get("check")+'</a> | <a href="admin.php?page=meoreader_moveFeed&amp;itemID='+data[i].feeds[n].id+'" class="move" title="'+MeoReader.i18n.get("Move this feed into another category")+'">'+MeoReader.i18n.get("move")+"</a></span></div>\n";html+=' <div class="htmlUrl">';if(data[i].feeds[n].html_url!==""){html+='<a href="'+data[i].feeds[n].html_url+'" class="www" target="_blank" title="homepage">'+data[i].feeds[n].html_url+"</a> &ensp; &ensp; ";}html+='<a href="'+data[i].feeds[n].xml_url+'" class="rss" target="_blank" title="rss feed">'+data[i].feeds[n].xml_url+"</a></div>\n";if(data[i].feeds[n].description!==""){html+=' <div class="description">'+data[i].feeds[n].description+"</div>\n";}html+="</div>\n";}}else{html+='<div class="feedItem"><i>'+MeoReader.i18n.get("Currently there are no feeds assigned to that category")+".</i></div>";}html+='<div class="clearAll">&nbsp;</div><p>&nbsp;</p>\n';html+="</div>\n";}return html;};MeoReader.updateSubscriptionListTemplate=function(html){jQuery("#meoReader_SubscriptionList").html(html);jQuery("h4.category label").removeClass("loading");};jQuery('<p><a href="javascript:void(0);" id="btn_toggleAll" title="'+MeoReader.i18n.get("Expand/Collapse All Categories")+'" class="button-secondary">[ &ndash; ]</a></p>').insertAfter("#meoReader_subscriptionTopBar");jQuery("#btn_toggleAll").click(function(){if(MeoReader.Subscriptions.categories.toggleState===1){jQuery("h4.category").removeClass("open").addClass("close");jQuery("h4.category").next(".entries").hide();jQuery(this).html("[ + ]");MeoReader.Subscriptions.categories.toggleState=0;}else{jQuery("h4.category").removeClass("close").addClass("open");jQuery("h4.category").next(".entries").show();jQuery(this).html("[ &ndash; ]");MeoReader.Subscriptions.categories.toggleState=1;}});if(MeoReader.compareVersions(MeoReader.jQueryVersion,"1.7.0")===-1){jQuery(document).on("click","h4.category",function(e){MeoReader.Subscriptions.toggleCategoryFeeds(jQuery(this),e);});}else{jQuery(document).delegate("h4.category","click",function(e){MeoReader.Subscriptions.toggleCategoryFeeds(jQuery(this),e);});}jQuery("#meoReaderForm_AddFeed").submit(function(){var feedURL=jQuery.trim(jQuery("#meoReaderForm_AddFeed_url").val()),catID=jQuery("#meoReaderForm_AddFeed_category").val();if(!feedURL.match(/^http(s)?:\/\//i)){MeoReader.loading.stop();MeoReader.box.create({id:"tmp",title:MeoReader.i18n.get("Error"),body:"<p>"+MeoReader.i18n.get("The feed has an invaid URL")+"!</p>",width:400,top:100,button:{ok:{enable:false},cancel:{enable:false},close:{enable:true}},state:"error",data:{}});return false;}MeoReader.loading.start();jQuery.post(ajaxurl,{action:"meoReader",method:"addFeed",feedURL:feedURL,catID:catID},function(response){var data=jQuery.parseJSON(response);MeoReader.loading.stop();if(data.request===true){MeoReader.updateSubscriptionList();jQuery("#meoReaderForm_AddFeed_url").val("");MeoReader.box.reset();}else{MeoReader.loading.stop();MeoReader.box.create({id:"tmp",title:MeoReader.i18n.get("Error"),body:"<p>"+data.message+"</p>",width:400,top:100,button:{ok:{enable:false},cancel:{enable:false},close:{enable:true}},state:"error",data:{}});}});return false;});if(MeoReader.compareVersions(MeoReader.jQueryVersion,"1.7.0")===-1){jQuery(document).on("click","a.delete",function(){MeoReader.Subscriptions.show_deleteItem_box(jQuery(this));return false;});}else{jQuery(document).delegate("a.delete","click",function(){MeoReader.Subscriptions.show_deleteItem_box(jQuery(this));return false;});}if(MeoReader.compareVersions(MeoReader.jQueryVersion,"1.7.0")===-1){jQuery(document).on("click","#MeoReader_Confirm_DeleteCategory a.btn.ok",function(){MeoReader.Subscriptions.deleteCategory();return false;});}else{jQuery(document).delegate("#MeoReader_Confirm_DeleteCategory a.btn.ok","click",function(){MeoReader.Subscriptions.deleteCategory();return false;});}if(MeoReader.compareVersions(MeoReader.jQueryVersion,"1.7.0")===-1){jQuery(document).on("click","#MeoReader_Confirm_DeleteFeed a.btn.ok",function(){MeoReader.Subscriptions.deleteFeed();return false;});}else{jQuery(document).delegate("#MeoReader_Confirm_DeleteFeed a.btn.ok","click",function(){MeoReader.Subscriptions.deleteFeed();return false;});}if(MeoReader.compareVersions(MeoReader.jQueryVersion,"1.7.0")===-1){jQuery(document).on("click","a.renameCategory",function(){var catItem=jQuery(this).parent().parent(),titleElement=jQuery(this).parent().siblings("label");MeoReader.Subscriptions.renameCategory(catItem,titleElement);return false;});jQuery(document).on("dblclick","h4.category label",function(){var catItem=jQuery(this).parent(),titleElement=jQuery(this);MeoReader.Subscriptions.renameCategory(catItem,titleElement);return false;});}else{jQuery(document).delegate("a.renameCategory","click",function(){MeoReader.Subscriptions.renameCategory(jQuery(this));return false;});jQuery(document).delegate("h4.category label","dblclick",function(){var catItem=jQuery(this).parent(),titleElement=jQuery(this);MeoReader.Subscriptions.renameCategory(catItem,titleElement);return false;});}if(MeoReader.compareVersions(MeoReader.jQueryVersion,"1.7.0")===-1){jQuery(document).on("click","a.move",function(){MeoReader.Subscriptions.prepare_moveFeed_box(jQuery(this));return false;});}else{jQuery(document).delegate("a.move","click",function(){MeoReader.Subscriptions.prepare_moveFeed_box(jQuery(this));return false;});}if(MeoReader.compareVersions(MeoReader.jQueryVersion,"1.7.0")===-1){jQuery(document).on("click","#MeoReader_Subscriptions_MoveFeed .btn.ok",function(){MeoReader.Subscriptions.moveFeed();return false;});}else{jQuery(document).delegate("#MeoReader_Subscriptions_MoveFeed .btn.ok","click",function(){MeoReader.Subscriptions.moveFeed();return false;});}jQuery("#meoReader_ImportExport").css("display","block");if(jQuery("#meoReaderForm_importMeoReader").length>0){jQuery("body").append('<script type="text/javascript" src="'+jQuery("#meoReader").attr("data-url")+'js/MeoReader.Import.js"><\/script>');}jQuery("#meoReader_ImportExport").hide();jQuery("#meoReader_toggleImportExport").click(function(){var area=jQuery("#meoReader_ImportExport"),button=jQuery(this);area.toggle(0,function(){if(area.is(":visible")){button.text("[ - ] Import / Export");}else{button.text("[ + ] Import / Export");}});});MeoReader.Subscriptions.deleteAllCategories=function(){MeoReader.box.title.addClass("loading");jQuery.post(ajaxurl,{action:"meoReader",method:"deleteAllCategories"},function(response){MeoReader.box.title.removeClass("loading");var data=jQuery.parseJSON(response);if(data.request===true){MeoReader.updateSubscriptionList();MeoReader.Subscriptions.updateCategorySelectList();MeoReader.box.reset();}else{MeoReader.loading.stop();MeoReader.box.create({id:"tmp",title:MeoReader.i18n.get("Error"),body:"<p>"+data.message+"</p>",width:400,top:100,button:{ok:{enable:false},cancel:{enable:false},close:{enable:true}},state:"error",data:{}});}});};MeoReader.Subscriptions.deleteAllFeeds=function(){MeoReader.box.title.addClass("loading");jQuery.post(ajaxurl,{action:"meoReader",method:"deleteAllFeeds"},function(response){MeoReader.box.title.removeClass("loading");var data=jQuery.parseJSON(response);if(data.request===true){MeoReader.updateSubscriptionList();MeoReader.Subscriptions.updateCategorySelectList();MeoReader.box.reset();}else{MeoReader.loading.stop();MeoReader.box.create({id:"tmp",title:MeoReader.i18n.get("Error"),body:"<p>"+data.message+"</p>",width:400,top:100,button:{ok:{enable:false},cancel:{enable:false},close:{enable:true}},state:"error",data:{}});}});};MeoReader.Subscriptions.show_deleteAllCategories_box=function(){var data={},config={},msg="<p>"+MeoReader.i18n.get("Confirm Delete All Cats")+"?</p>";config.id="MeoReader_Confirm_DeleteAllCategories";MeoReader.box.create({id:config.id,title:MeoReader.i18n.get("Confirm Deletion"),body:msg,width:400,top:100,button:{ok:{enable:true,label:MeoReader.i18n.get("Yes")},cancel:{enable:true},close:{enable:false}},state:"neutral",data:data});};MeoReader.Subscriptions.show_deleteAllFeeds_box=function(){var data={},config={},msg="<p>"+MeoReader.i18n.get("Confirm Delete All Feeds")+"</p>";config.id="MeoReader_Confirm_DeleteAllFeeds";MeoReader.box.create({id:config.id,title:MeoReader.i18n.get("Confirm Deletion"),body:msg,width:400,top:100,button:{ok:{enable:true,label:MeoReader.i18n.get("Yes")},cancel:{enable:true},close:{enable:false}},state:"neutral",data:data});};jQuery("#meoReader_btn_deleteAllCats").click(function(){MeoReader.Subscriptions.show_deleteAllCategories_box();return false;});jQuery("#meoReader_btn_deleteAllFeeds").click(function(){MeoReader.Subscriptions.show_deleteAllFeeds_box();return false;});if(MeoReader.compareVersions(MeoReader.jQueryVersion,"1.7.0")===-1){jQuery(document).on("click","#MeoReader_Confirm_DeleteAllCategories a.btn.ok",function(){MeoReader.Subscriptions.deleteAllCategories();return false;});}else{jQuery(document).delegate("#MeoReader_Confirm_DeleteAllCategories a.btn.ok","click",function(){MeoReader.Subscriptions.deleteAllCategories();return false;});}if(MeoReader.compareVersions(MeoReader.jQueryVersion,"1.7.0")===-1){jQuery(document).on("click","#MeoReader_Confirm_DeleteAllFeeds a.btn.ok",function(){MeoReader.Subscriptions.deleteAllFeeds();return false;});}else{jQuery(document).delegate("#MeoReader_Confirm_DeleteAllFeeds a.btn.ok","click",function(){MeoReader.Subscriptions.deleteAllFeeds();return false;});}
